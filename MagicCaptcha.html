<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Captcha</title>
  <style>
    /* Styles CSS */
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .form-container {
      margin-top: -100px;
      margin-left: -100px;
    }
  </style>
</head>

<body onload="chrono()"> <!-- Appelle la fonction chrono() lors du chargement de la page -->
<div class="container">
  <h3>CAPTCHA</h3>
  <canvas class="canvas" id="dessin" width="300" height="300"></canvas> <!-- Canvas pour dessiner le CAPTCHA -->
  <div class="form-container">
    <label for="input">Valeur </label><input id="input" type="text"/> <!-- Champ de saisie -->
    <button id="bouton">Vérifier</button> <!-- Bouton de vérification -->
    <p id="p2"></p> <!-- Paragraphe pour afficher le résultat -->
  </div>
</div>

<script type="text/javascript">
  var canvas = document.getElementById("dessin"); // Récupère l'élément canvas
  var contexte = canvas.getContext("2d"); // Récupère le contexte de dessin 2D
  var valeurAleatoire = Math.floor(Math.random() * (9999 - 1000 + 1) + 1000); // Génère un nombre aléatoire entre 1000 et 9999
  var valeurSaisie = document.getElementById('input'); // Récupère l'élément de saisie
  var isOk = document.getElementById('p2'); // Récupère l'élément pour afficher le résultat
  var compteur = 0; // Initialise un compteur

  // Dessine les chiffres du nombre aléatoire séparément sur le canvas
  var chiffres = valeurAleatoire.toString().split('');
  contexte.strokeRect(10, 30, 50 * chiffres.length, 160); // Dessine un rectangle sur le canvas
  contexte.font = '40px serif'; // Définit la police de caractères pour le texte
  for (var i = 0; i < chiffres.length; i++) {
    contexte.fillText(chiffres[i], 20 + (50 * i), 120); // Dessine chaque chiffre sur le canvas
  }

  // Ajoute un écouteur d'événement au bouton de vérification
  document.getElementById('bouton').addEventListener('click', function () {
    if (valeurAleatoire === parseInt(valeurSaisie.value)) // Vérifie si la saisie correspond au CAPTCHA
      isOk.innerHTML = "OK"; // Affiche "OK" si la saisie est correcte
    else {
      isOk.innerHTML = "PAS OK"; // Affiche "PAS OK" si la saisie est incorrecte
    }
  });

  // Fonction pour réinitialiser le CAPTCHA
  function reset() {
    valeurAleatoire = Math.floor(Math.random() * (9999 - 1000 + 1) + 1000); // Regénère un nombre aléatoire
    resetCaptcha(); // Appelle la fonction pour réinitialiser le CAPTCHA
    isOk.innerHTML = ""; // Efface le résultat précédent
    valeurSaisie.value = ""; // Efface la saisie précédente
    compteur = 0; // Réinitialise le compteur
  }

  // Fonction pour le chronomètre
  function chrono() {
    if (compteur < 15) // Vérifie si le compteur est inférieur à 15
      compteur++; // Incrémente le compteur
    else {
      reset(); // Réinitialise le CAPTCHA lorsque le compteur atteint 15
    }
    setTimeout(chrono, 1000); // Appelle la fonction chrono() chaque seconde
  }

  // Fonction pour réinitialiser le CAPTCHA
  function resetCaptcha() {
    contexte.clearRect(0, 0, canvas.width, canvas.height); // Efface le contenu du canvas
    var chiffresEspace = valeurAleatoire.toString().split('');
    contexte.strokeRect(10, 30, 50 * chiffres.length, 160); // Dessine un rectangle sur le canvas
    contexte.font = '40px serif'; // Définit la police de caractères pour le texte
    for (var i = 0; i < chiffres.length; i++) {
      contexte.fillText(chiffres[i], 20 + (50 * i), 120); // Dessine chaque chiffre sur le canvas
    }
  }

</script>

</body>
</html>
